<atlassian-plugin key="${project.groupId}.${project.artifactId}" name="${project.name}" plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <version>${project.version}</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}" />
    </plugin-info>

    <servlet-filter key="fixAuthenticateHeader" class="com.atlassian.labs.remoteapps.installer.FixAuthenticateHeaderFilter"
            location="after-encoding">
        <url-pattern>/rest/remoteapps/*</url-pattern>
    </servlet-filter>
    <servlet-filter key="iframe-resources" class="com.atlassian.labs.remoteapps.iframe.StaticResourcesFilter"
            location="after-encoding">
        <url-pattern>/remoteapps/*</url-pattern>
    </servlet-filter>

    <servlet-filter key="api-scoping" class="com.atlassian.labs.remoteapps.modules.permissions.ApiScopingFilter"
            location="before-login">
        <url-pattern>/*</url-pattern>
    </servlet-filter>

    <servlet-filter key="oauth-2lo-authentication" class="com.atlassian.labs.remoteapps.modules.oauth.OAuth2LOFilter"
            location="after-encoding">
        <url-pattern>/*</url-pattern>
    </servlet-filter>

    <module-type key="remote-app" class="com.atlassian.labs.remoteapps.descriptor.RemoteAppModuleDescriptor" />

    <web-resource key="xdm">
        <context>remoteapps-iframe</context>
        <dependency>com.atlassian.auiplugin:ajs</dependency>
        <resource type="download" name="easyXDM.js" location="/js/iframe/easyXDM.js" />
    </web-resource>

    <web-resource key="iframe">
        <resource type="download" name="easyXDM.js" location="/js/iframe/easyXDM.js" />
        <resource type="download" name="main.js" location="/js/iframe/main.js" />
    </web-resource>

    <commonjs key="speakeasy-commonjs" location="/js/speakeasy" />

    <web-resource key="speakeasy-integration">
        <context>speakeasy.user-profile</context>
        <dependency>com.atlassian.labs.remoteapps-plugin:remoteapps_installer</dependency>
    </web-resource>

    <web-item key="speakeasy-install" section="speakeasy.user-profile/actions" weight="100">
        <label>Install Remote App</label>
        <link linkId="rp-install" />
        <condition class="com.atlassian.labs.remoteapps.descriptor.CanInstallRemoteAppsCondition" />
    </web-item>

    <rest key="rest" path="/remoteapps" version="1" package="com.atlassian.labs.remoteapps.rest">
        <dispatcher>REQUEST</dispatcher>
        <dispatcher>INCLUDE</dispatcher>
    </rest>

    <component key="startableForPlugins" class="com.atlassian.labs.remoteapps.descriptor.StartableForPlugins" public="true"
               interface="com.atlassian.sal.api.lifecycle.LifecycleAware" />
    <component key="classPrefixModuleFactory" class="com.atlassian.plugin.module.ClassPrefixModuleFactory"/>

    <component-import key="templateRenderer" interface="com.atlassian.templaterenderer.TemplateRenderer"/>
    <component-import key="servletModuleManager" interface="com.atlassian.plugin.servlet.ServletModuleManager" />
    <component-import key="webInterfaceManager" interface="com.atlassian.plugin.web.WebInterfaceManager" />
    <component-import key="pluginRetrievalService" interface="com.atlassian.plugin.osgi.bridge.external.PluginRetrievalService" />
    <component-import key="oauthConsumerService" interface="com.atlassian.oauth.consumer.ConsumerService" />
    <component-import key="requestFactory" interface="com.atlassian.sal.api.net.RequestFactory" />
    <component-import key="pluginController" interface="com.atlassian.plugin.PluginController" />
    <component-import key="applicationProperties" interface="com.atlassian.sal.api.ApplicationProperties" />
    <component-import key="serviceProviderConsumerStore" interface="com.atlassian.oauth.serviceprovider.ServiceProviderConsumerStore" />
    <component-import key="applicationLinkService" interface="com.atlassian.applinks.spi.link.MutatingApplicationLinkService" />
    <component-import key="authenticationConfigurationManager" interface="com.atlassian.applinks.spi.auth.AuthenticationConfigurationManager" />
    <component-import key="userManager" interface="com.atlassian.sal.api.user.UserManager" />
    <component-import key="authenticationListener" interface="com.atlassian.sal.api.auth.AuthenticationListener" />
    <component-import key="authenticationController" interface="com.atlassian.sal.api.auth.AuthenticationController" />
    <component-import key="transactionTemplate" interface="com.atlassian.sal.api.transaction.TransactionTemplate" />
    <component-import key="pluginEventManager" interface="com.atlassian.plugin.event.PluginEventManager" />
    <component-import key="pluginAccessor" interface="com.atlassian.plugin.PluginAccessor" />
    <component-import key="webResourceManager" interface="com.atlassian.plugin.webresource.WebResourceManager" />
    <component-import key="eventPublisher" interface="com.atlassian.event.api.EventPublisher" />

    <module-type key="api-scope" class="com.atlassian.labs.remoteapps.modules.permissions.scope.ApiScopeModuleDescriptor" />

    <module-type key="access-level" class="com.atlassian.labs.remoteapps.descriptor.external.AccessLevelModuleDescriptor" />

    <access-level key="global" class="com.atlassian.labs.remoteapps.GlobalAccessLevel" />

    <!-- product-specific modules included via xslt build process -->

</atlassian-plugin>
