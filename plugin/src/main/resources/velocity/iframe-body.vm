<div class="ra-container" id="ra-$namespace">
  $!extraMarkupHtml
  <div class="ra-content" id="embedded-$namespace"></div>
  <div class="ra-stats hidden">
    <div class="ra-loading ra-status">
      Loading plugin <a href="${plugin.displayUrl}" target="_blank">$plugin.name</a>.
    </div>
    <div class="ra-loaded ra-status hidden">
      Loaded plugin <a href="${plugin.displayUrl}" target="_blank">$plugin.name</a>.
    </div>
    <div class="ra-load-timeout ra-status hidden">
      Plugin <a href="${plugin.displayUrl}" target="_blank">$plugin.name</a> is not responding.
      <a href="#" class="ra-btn-wait">Wait</a> or <a href="#" class="ra-btn-cancel">Cancel</a>?
    </div>
    <div class="ra-load-error ra-status hidden">
      Plugin <a href="${plugin.displayUrl}" target="_blank">$plugin.name</a> failed to load.
    </div>
  </div>
  ## @todo optimize script delivery
  #foreach ($scriptUrl in $scriptUrls)
    <script src="$scriptUrl"></script>
  #end
  <script>
    (function(jQuery, JIRA) {
        function init() {
          _AP.create({
            ns: "$namespace",
            src: "$iframeSrcHtml",
            width: "$!width",
            height: "$!height",
            contextPath: "$contextPath",
            appKey: "$plugin.key",
            userId: "$userId",
            dialog: "$!dialog"
          });
        }
        if (JIRA) {
            jQuery(function() {
                JIRA.bind(JIRA.Events.NEW_CONTENT_ADDED, function(e, context, reason) {
                    var jcontext = jQuery(context);
                    if (jQuery('#ra-$namespace', jcontext).length > 0) {
                        init();
                    }
                });
            });
        }
        init();
    })(jQuery, window.JIRA);
  </script>
</div>
