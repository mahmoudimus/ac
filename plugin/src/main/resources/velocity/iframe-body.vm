<div>
    <div id="embedded-$namespace"></div>
    <hr />
    <div id="ra-stats-$namespace" style="color: gray; font-size: smaller">
        Loaded from <span id="ra-key-$namespace"><a href="${remoteapp.displayUrl}">$remoteapp.name</a></span>  in
        <span id="ra-time-$namespace">...</span> ms
    </div>
    <script type="text/javascript" language="javascript">
        (function($) {
            var container = $('#embedded-$namespace');
            var initHeight = '#if($height)$height#else 10em #end';
            var initWidth = '#if($width)$width#else 100%#end';
            var iframeSrc = '$iframeSrcHtml';
            function resize(height, width){
                var iframe = $('iframe', container);
                iframe.css('height', height + "px");
                iframe.css('width', width + (/%/.test(width)? "" : "px"));
            }
            var now = new Date().getTime();
            var transport = new easyXDM.Socket(/** The configuration */{
                remote: iframeSrc,

                //ID of the element to attach the inline frame to
                container: "embedded-$namespace",
                channel: "channel-$namespace",
                props: {height : initHeight, width : initWidth},
                onMessage: function (messageText, origin) {
                    var message = JSON.parse(messageText);
                    switch (message.id) {
                        case 'init' : container.addClass('iframe-init');
                                      $('#ra-time-$namespace').text(new Date().getTime() - now);
                                      break;

                        case 'resize' : resize(message.height, message.width);
                                        break;

                        case 'getIssue' : transport.postMessage(JSON.stringify({id:"issue", value:"their whoslookin remote app profile"}));
                                       	  break;

                        case 'getUsername' : var username = jQuery('a#header-details-user-fullname').text();
                        			         transport.postMessage(JSON.stringify({id:"username", value:username}));
                                             break;
                    }
                }
            });
        })(jQuery);
    </script>
</div>