<?xml version="1.0" encoding="UTF-8"?>

<beans:beans xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:osgi="http://www.springframework.org/schema/osgi"
             xmlns:context="http://www.springframework.org/schema/context"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
http://www.springframework.org/schema/osgi http://www.springframework.org/schema/osgi/spring-osgi.xsd
http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-2.5.xsd"
             default-autowire="autodetect">

    <beans:bean id="bundleContext" class="com.atlassian.labs.remoteapps.kit.common.spring.BundleContextFactoryBean" />
    <beans:bean id="applicationContext" class="com.atlassian.labs.remoteapps.kit.common.spring.ApplicationContextFactoryBean" />

    <beans:bean id="httpUtils" class="com.atlassian.labs.remoteapps.kit.common.HttpUtils"
                autowire="constructor"/>

    <context:component-scan base-package="servlets"/>
    <context:component-scan base-package="services"/>

    <osgi:reference id="pluginRetrieval" interface="com.atlassian.plugin.osgi.bridge.external.PluginRetrievalService" />
    <osgi:reference id="descriptorGenerator" interface="com.atlassian.labs.remoteapps.api.DescriptorGenerator" timeout="20000" />
    <osgi:reference id="pluginSettingsFactory" interface="com.atlassian.sal.api.pluginsettings.PluginSettingsFactory" />

    <beans:bean id="ao" class="com.atlassian.labs.remoteapps.kit.common.spring.ComponentFactoryBean" lazy-init="true" depends-on="aoConfig">
        <beans:constructor-arg index="0" ref="bundleContext"/>
        <beans:constructor-arg index="1" value="com.atlassian.activeobjects.external.ActiveObjects"/>
    </beans:bean>

    <beans:bean id="aoConfig" class="com.atlassian.labs.remoteapps.kit.common.ao.ActiveObjectsConfigurationFactoryBean" lazy-init="true">
        <beans:constructor-arg index="0" ref="applicationContext" />
        <beans:constructor-arg index="1" ref="bundleContext" />
        <beans:constructor-arg index="2">
            <osgi:reference interface="com.atlassian.activeobjects.config.ActiveObjectsConfigurationFactory" />
        </beans:constructor-arg>
    </beans:bean>

    <osgi:reference id="signedRequestHandler" interface="com.atlassian.labs.remoteapps.api.services.SignedRequestHandler" />

    <beans:bean id="httpResourceProvider" class="com.atlassian.labs.remoteapps.kit.servlet.ServletKitBootstrap" autowire="constructor"/>

</beans:beans>
